{% extends "base.html" %}

{% block title %}Changes - PDF Monitor{% endblock %}

{% block content %}
<h1>Recent Changes</h1>

{% if changes %}
<div class="card">
    <table>
        <thead>
            <tr>
                <th>URL</th>
                <th>Change Type</th>
                <th>Classification</th>
                <th>Similarity</th>
                <th>Detected</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for item in changes %}
            <tr class="{% if not item.change.reviewed and item.change.change_type != 'new' %}row-changed{% endif %}">
                <td>
                    <div class="card-title">{{ item.url_name }}</div>
                </td>
                <td>
                    <span class="badge {% if item.change.change_type == 'new' %}badge-info{% elif item.change.change_type == 'text_changed' %}badge-warning{% elif item.change.change_type == 'binary_changed' %}badge-neutral{% else %}badge-success{% endif %}">
                        {{ item.change.change_type|replace('_', ' ')|title }}
                    </span>
                </td>
                <td>
                    {# PoC-aligned classification labels #}
                    {% if item.change.match_type == 'form_number_match' %}
                        <span class="badge badge-success" style="font-size: 0.7rem;">ğŸ“‹ Updated Form (Same Name)</span>
                    {% elif item.change.match_type == 'similarity_match' %}
                        <span class="badge badge-info" style="font-size: 0.7rem;">ğŸ“Š Updated Form (Name Change)</span>
                    {% elif item.change.match_type == 'new_form' %}
                        <span class="badge badge-error" style="font-size: 0.7rem;">ğŸ†• New Form</span>
                    {% elif item.change.match_type == 'uncertain' %}
                        <span class="badge badge-warning" style="font-size: 0.7rem;">â“ Needs Review</span>
                    {% elif item.change.change_type == 'new' %}
                        <span class="badge badge-info" style="font-size: 0.7rem;">ğŸ†• New Form</span>
                    {% else %}
                        <span style="color: var(--text-secondary);">â€”</span>
                    {% endif %}
                </td>
                <td>
                    {% if item.change.similarity_score %}
                        <span style="font-weight: 600;">{{ (item.change.similarity_score * 100)|round|int }}%</span>
                    {% else %}
                        <span style="color: var(--text-secondary);">â€”</span>
                    {% endif %}
                </td>
                <td>
                    <span class="timestamp">{{ item.change.detected_at.strftime('%Y-%m-%d %H:%M') }}</span>
                </td>
                <td>
                    <a href="/url/{{ item.change.monitored_url_id }}" class="btn btn-secondary btn-sm">View URL</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{% else %}
<div class="card">
    <div class="empty-state">
        <div class="empty-state-icon">ğŸ“Š</div>
        <h2>No Changes Yet</h2>
        <p>Run a monitoring cycle to start detecting changes.</p>
    </div>
</div>
{% endif %}
{% endblock %}


